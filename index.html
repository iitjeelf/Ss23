<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Portal</title>
<style>
  body {
    background: linear-gradient(to right, #E6E6FA, #D8BFD8);
    font-family: Arial, sans-serif;
    text-align: center;
  }
  .glow {
    color: white;
    background-color: purple;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 0 10px purple;
  }
  .glow:hover { background-color: indigo; }
  .blink {
    animation: blink 1s infinite;
  }
  @keyframes blink {
    50% { color: red; }
  }
  #examArea, #fullRedOverlay, #accessDeniedBox { display: none; }
  #fullRedOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,0,0,0.3);
    z-index: 1000;
  }
  #accessDeniedBox {
    position: absolute;
    top: 40%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border: 2px solid red;
    padding: 20px;
    border-radius: 10px;
  }
  table {
    border-collapse: collapse;
    width: 130%;
    margin: 0 auto;
    transform: scale(0.77);
    font-size: 18px;
  }
  th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: center;
  }
</style>
</head>
<body>

<div id="studentEntry">
  <h2 style="color:purple;">STUDENT LOGIN</h2>
  <input id="name" placeholder="Name"><br><br>
  <input id="section" placeholder="Section"><br><br>
  <input id="roll" placeholder="Roll Number"><br><br>
  <input id="adm" placeholder="Admission Number"><br><br>
  <button id="startExamBtn" class="glow">Start Exam</button>
</div>

<div id="examArea">
  <div id="stuInfo" style="font-weight:bold;margin-bottom:5px;"></div>
  <div id="timerEl" style="font-weight:bold;margin-bottom:10px;"></div>
  <h3 id="questionCount"></h3>
  <div id="questionBox"></div>
  <div id="optionsBox"></div>
  <br>
  <button id="prevBtn" class="glow">Previous</button>
  <button id="markReviewBtn" class="glow">Review</button>
  <button id="nextBtn" class="glow">Next</button>
  <button id="submitBtn" class="glow">Submit Exam</button>
</div>

<div id="fullRedOverlay"></div>
<div id="accessDeniedBox">
  <h3 style="color:red;">ACCESS DENIED</h3>
  <p>Your access is blocked for 24 hours.</p>
  <button id="callAdminBtn" class="glow">Admin Override</button>
</div>

<script>
let examData={}, progress={}, timerInterval=null, pendingAttempt=null;
function prepareExamData(){
  examData={
    files:["q1.png","q2.png","q3.png"],
    keys:["A","B","C"],
    subjects:["Maths","Physics","Chemistry"]
  };
}
function renderQuestion(){
  document.getElementById("questionCount").textContent =
    `Question ${progress.currentIndex+1}/${examData.files.length}`;
  document.getElementById("questionBox").innerHTML =
    `<img src="${examData.files[progress.currentIndex]}" style="width:400px;height:auto;">`;
}
function renderPalette(){}
function updateNavButtons(){}

function startTimer(){
  const timerEl=document.getElementById('timerEl');
  const stuInfo=document.getElementById('stuInfo');
  timerInterval=setInterval(()=>{
    if(progress.timeLeftSec<=0){
      clearInterval(timerInterval);
      alert("â° Time Up! Submitting automaticallyâ€¦");
      submitExam();
      return;
    }
    progress.timeLeftSec--;
    const min=Math.floor(progress.timeLeftSec/60);
    const sec=progress.timeLeftSec%60;
    timerEl.textContent=`ðŸ•’ ${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
    stuInfo.textContent=`${progress.student.name} | ${progress.student.sec} | ${progress.student.roll} | ${progress.student.adm}`;
    if(progress.timeLeftSec<=300){ timerEl.classList.add('blink'); }
    else timerEl.classList.remove('blink');
    if(progress.timeLeftSec<=60){
      stuInfo.classList.add('blink');
      timerEl.classList.add('blink');
    } else stuInfo.classList.remove('blink');
  },1000);
}

function submitExam(){
  clearInterval(timerInterval);
  const total=examData.files.length;
  const correct=1, wrong=1, blank=1; // dummy calculation
  const percent=((correct*100)/total).toFixed(1);
  document.getElementById('examArea').innerHTML=`
    <h2 style="color:#4B0082;">RESULT</h2>
    <div style="font-weight:bold;margin-bottom:10px;">
      Student: ${progress.student.name} | Section: ${progress.student.sec} | Roll: ${progress.student.roll} | Adm: ${progress.student.adm}
    </div>
    <table>
      <tr style="background:#E6E6FA;"><th>Subject</th><th>Correct</th><th>Wrong</th><th>Blank</th><th>Total</th><th>%</th></tr>
      <tr><td>Maths</td><td>1</td><td>0</td><td>0</td><td>1</td><td>100%</td></tr>
      <tr><td>Physics</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0%</td></tr>
      <tr><td>Chemistry</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0%</td></tr>
      <tr style="font-weight:bold;background:#E6E6FA;">
        <td>Total</td><td>${correct}</td><td>${wrong}</td><td>${blank}</td><td>${total}</td><td>${percent}%</td>
      </tr>
    </table>
    <button id="logoutBtn" class="glow" style="margin-top:20px;">Logout</button>`;
  document.getElementById('logoutBtn').onclick=()=>{window.close();window.location.href='about:blank';};
}

document.getElementById('startExamBtn').onclick=()=>{
  const name=document.getElementById('name').value.trim();
  const section=document.getElementById('section').value.trim();
  const roll=document.getElementById('roll').value.trim();
  const adm=document.getElementById('adm').value.trim();
  if(!name||!section||!roll||!adm){
    [name,section,roll,adm].forEach(id=>{
      const el=document.getElementById(id);
      if(!el.value) el.classList.add('blink');
      else el.classList.remove('blink');
    });
    return;
  }
  prepareExamData();
  progress={answers:[],review:[],currentIndex:0,student:{name,sec:section,roll,adm},timeLeftSec:5*60};
  document.getElementById('studentEntry').style.display='none';
  document.getElementById('examArea').style.display='block';
  renderQuestion();
  startTimer();
};

document.getElementById('markReviewBtn').onclick=()=>{
  const btn=document.getElementById('markReviewBtn');
  if(btn.textContent==="Review"){ btn.textContent="Unreview"; }
  else { btn.textContent="Review"; }
};

document.getElementById('submitBtn').onclick=()=>{
  if(confirm("Are you sure you want to SUBMIT the exam?")) submitExam();
};

function showRedOverlay(){
  const overlay=document.getElementById('fullRedOverlay');
  const msg=document.getElementById('accessDeniedBox');
  overlay.style.display='block'; msg.style.display='block';
  document.getElementById('callAdminBtn').onclick=()=>{
    const p=prompt("Enter admin password:");
    if(p==="lfjc2025"){
      overlay.style.display='none'; msg.style.display='none'; overlay.innerHTML='';
      // âœ… start exam immediately after admin override
      prepareExamData();
      progress={answers:[],review:[],currentIndex:0,student:{name:"Admin",sec:"-",roll:"-",adm:"-"},timeLeftSec:5*60};
      document.getElementById('studentEntry').style.display='none';
      document.getElementById('examArea').style.display='block';
      renderQuestion();
      startTimer();
    }
  };
}
</script>
</body>
</html>
